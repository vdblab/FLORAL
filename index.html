<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fit Log-Ratio Lasso Regression for Compositional Data • FLORAL</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Fit Log-Ratio Lasso Regression for Compositional Data">
<meta name="description" content="Log-ratio Lasso regression for continuous, binary, and survival outcomes with (longitudinal) compositional features. See Fei and others (2024) &lt;doi:10.1016/j.crmeth.2024.100899&gt;.">
<meta property="og:description" content="Log-ratio Lasso regression for continuous, binary, and survival outcomes with (longitudinal) compositional features. See Fei and others (2024) &lt;doi:10.1016/j.crmeth.2024.100899&gt;.">
<meta property="og:image" content="https://vdblab.github.io/FLORAL/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">FLORAL</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/Using-FLORAL-for-Microbiome-Analysis.html">Using FLORAL for Microbiome Analysis</a></li>
    <li><a class="dropdown-item" href="articles/Using-FLORAL-for-survival-models-with-longitudinal-microbiome-data.html">Using FLORAL for survival models with longitudinal microbiome data</a></li>
    <li><a class="dropdown-item" href="articles/Using-FLORAL-with-phyloseq.html">Using FLORAL with phyloseq data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/vdblab/FLORAL/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="floral-fit-log-ratio-lasso-regression-for-compositional-covariates-">FLORAL: Fit LOg-RAtio Lasso regression for compositional covariates <a class="anchor" aria-label="anchor" href="#floral-fit-log-ratio-lasso-regression-for-compositional-covariates-"></a>
</h1>
</div>
<!-- badges: start -->

<p>The <code>FLORAL</code> package is an open-source computational tool to perform log-ratio lasso regression modeling and compositional feature selection for continuous, binary, time-to-event, and competing risk outcomes. The proposed method adapts the augmented Lagrangian algorithm for a zero-sum constraint optimization problem while enabling a two-stage screening process for extended false-positive control.</p>
<p>The associated article for <code>FLORAL</code> is available on <a href="https://doi.org/10.1016/j.crmeth.2024.100899" class="external-link">Cell Reports Methods</a>.</p>
<div class="section level2">
<h2 id="system-requirements-and-installation">System requirements and installation<a class="anchor" aria-label="anchor" href="#system-requirements-and-installation"></a>
</h2>
<p>The current version of <code>FLORAL</code> (0.5.0) was built in R version 4.4.2. R package dependencies can be found in the <code>DESCRIPTION</code> file.</p>
<p>You can install <code>FLORAL</code> with the following code. The installation is typically complete within minutes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"FLORAL"</span><span class="op">)</span></span></code></pre></div>
<p>You can also install <code>FLORAL</code> using conda:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">conda</span> install <span class="at">-c</span> bioconda r-floral</span></code></pre></div>
<p>You can install the development version of <code>FLORAL</code> from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"vdblab/FLORAL"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Here is a toy example for linear regression with 10-fold cross-validation for a simulated data with 50 samples and 100 compositional features. Option <code>progress=TRUE</code> can be used to show the progress bar of the running algorithm.</p>
<p>The data simulation procedure is described in the preprint. The expected run time for the following demo is about a minute.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">23420</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vdblab.github.io/FLORAL/">FLORAL</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu.html">simu</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>,p<span class="op">=</span><span class="fl">100</span>,model<span class="op">=</span><span class="st">"linear"</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/FLORAL.html">FLORAL</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">xcount</span>,<span class="va">dat</span><span class="op">$</span><span class="va">y</span>,family<span class="op">=</span><span class="st">"gaussian"</span>,ncv<span class="op">=</span><span class="fl">10</span>,progress<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>To view plots of cross-validated prediction error and parameter coefficients, use <code>fit$pmse</code> or <code>fit$pcoef</code>:</p>
<p><img src="reference/figures/README-plot-1.png" width="50%"><img src="reference/figures/README-plot-2.png" width="50%"></p>
<p>To view selected compositional features, use <code>fit$selected.feature</code>, where features are sorted by their names. Features under <code>min</code> and <code>1se</code> correspond to penalty parameter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mo>min</mo></msub><annotation encoding="application/x-tex">\lambda_{\min}</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mtext mathvariant="normal">1se</mtext></msub><annotation encoding="application/x-tex">\lambda_{\text{1se}}</annotation></semantics></math>, respectively. Features under <code>min.2stage</code> and <code>1se.2stage</code> are obtained after applying 2-stage filtering based on features under <code>min</code> and <code>1se</code>, respectively.</p>
<p>We recommend interpreting the selected compositional features as potential predictive markers to the outcome in the regression model in the sense that the cross-validated prediction error is improved by considering these selected features.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">selected.feature</span></span>
<span><span class="co">#&gt; $min</span></span>
<span><span class="co">#&gt;  [1] "taxa1"  "taxa10" "taxa15" "taxa2"  "taxa29" "taxa3"  "taxa39" "taxa43"</span></span>
<span><span class="co">#&gt;  [9] "taxa5"  "taxa6"  "taxa7"  "taxa8"  "taxa9"  "taxa92"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1se`</span></span>
<span><span class="co">#&gt;  [1] "taxa1"  "taxa10" "taxa2"  "taxa3"  "taxa39" "taxa5"  "taxa6"  "taxa7" </span></span>
<span><span class="co">#&gt;  [9] "taxa8"  "taxa9" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $min.2stage</span></span>
<span><span class="co">#&gt;  [1] "taxa1"  "taxa10" "taxa2"  "taxa3"  "taxa43" "taxa5"  "taxa6"  "taxa7" </span></span>
<span><span class="co">#&gt;  [9] "taxa8"  "taxa9"  "taxa92"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1se.2stage`</span></span>
<span><span class="co">#&gt; [1] "taxa1"  "taxa10" "taxa2"  "taxa3"  "taxa5"  "taxa6"  "taxa7"  "taxa8" </span></span>
<span><span class="co">#&gt; [9] "taxa9"</span></span></code></pre></div>
<p>To get specific log-ratios selected by the 2-stage procedure, use <code>fit$step2.log-ratios</code>, where <code>min</code> and <code>1se</code> display the log-ratios between features. For each identified ratio, <code>min.idx</code> and <code>1se.idx</code> return the column indices in the original input matrix for the two corresponding features forming the ratio.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">step2.ratios</span></span>
<span><span class="co">#&gt; $min</span></span>
<span><span class="co">#&gt; [1] "taxa1/taxa10"  "taxa2/taxa5"   "taxa3/taxa8"   "taxa5/taxa8"  </span></span>
<span><span class="co">#&gt; [5] "taxa6/taxa9"   "taxa7/taxa92"  "taxa10/taxa43"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1se`</span></span>
<span><span class="co">#&gt; [1] "taxa1/taxa10" "taxa2/taxa5"  "taxa3/taxa8"  "taxa5/taxa8"  "taxa6/taxa9" </span></span>
<span><span class="co">#&gt; [6] "taxa7/taxa10"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $min.idx</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">#&gt; [1,]   NA    1    2    3    5    6    7   10</span></span>
<span><span class="co">#&gt; [2,]   NA   10    5    8    8    9   92   43</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1se.idx`</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span></span>
<span><span class="co">#&gt; [1,]   NA    1    2    3    5    6    7</span></span>
<span><span class="co">#&gt; [2,]   NA   10    5    8    8    9   10</span></span></code></pre></div>
<p>More detailed interpretations can be obtained for the selected log-ratios. First, the selected log-ratios also improve the cross-validated prediction errors because these log-ratios are derived from the constrained lasso estimate. Moreover, as guided by the association table between log-ratios and the outcome, it is possible to interpret the directions of the covariate effects associated with certain log-ratios on the outcome. To view detailed associations between selected log-ratios and the outcome, use <code>fit$step2.tables</code> to print summary tables for the multivariable stepwise regression models obtained by the 2-stage procedure.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">step2.tables</span><span class="op">$</span><span class="va">min</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">step2.tables</span><span class="op">$</span><span class="va">`1se`</span></span></code></pre></div>
<p>For binary and survival outcomes, please specify <code>family="binomial"</code>, <code>family="cox"</code>, or <code>family="finegray"</code> accordingly.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat.bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu.html">simu</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>,p<span class="op">=</span><span class="fl">100</span>,model<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">fit.bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/FLORAL.html">FLORAL</a></span><span class="op">(</span><span class="va">dat.bin</span><span class="op">$</span><span class="va">xcount</span>,<span class="va">dat.bin</span><span class="op">$</span><span class="va">y</span>,family<span class="op">=</span><span class="st">"binomial"</span>,ncv<span class="op">=</span><span class="fl">10</span>,progress<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat.cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu.html">simu</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>,p<span class="op">=</span><span class="fl">100</span>,model<span class="op">=</span><span class="st">"cox"</span><span class="op">)</span></span>
<span><span class="va">fit.cox</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/FLORAL.html">FLORAL</a></span><span class="op">(</span><span class="va">dat.cox</span><span class="op">$</span><span class="va">xcount</span>,<span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">dat.cox</span><span class="op">$</span><span class="va">t</span>,<span class="va">dat.cox</span><span class="op">$</span><span class="va">d</span><span class="op">)</span>,family<span class="op">=</span><span class="st">"cox"</span>,ncv<span class="op">=</span><span class="fl">10</span>,progress<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat.fg</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simu.html">simu</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>,p<span class="op">=</span><span class="fl">100</span>,model<span class="op">=</span><span class="st">"finegray"</span><span class="op">)</span></span>
<span><span class="va">fit.fg</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/FLORAL.html">FLORAL</a></span><span class="op">(</span><span class="va">dat.cox</span><span class="op">$</span><span class="va">xcount</span>,<span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">dat.cox</span><span class="op">$</span><span class="va">t</span>,<span class="va">dat.cox</span><span class="op">$</span><span class="va">d</span>,type<span class="op">=</span><span class="st">"mstate"</span><span class="op">)</span>,family<span class="op">=</span><span class="st">"finegray"</span>,ncv<span class="op">=</span><span class="fl">10</span>,progress<span class="op">=</span><span class="cn">FALSE</span>,step2<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="repository-for-reproducibility">Repository for Reproducibility<a class="anchor" aria-label="anchor" href="#repository-for-reproducibility"></a>
</h2>
<p>Reproducible code for the analyses results reported in the manuscript can be found at <a href="https://github.com/vdblab/FLORAL-analysis" class="external-link">this repository</a>.</p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>The <code>FLORAL</code> package is jointly managed by <a href="https://www.mskcc.org/departments/epidemiology-biostatistics/biostatistics" class="external-link">MSKCC Biostatistics service</a> and the Marcel van den Brink Lab. Please note that the <code>FLORAL</code> project is released with a <a href="https://github.com/vdblab/FLORAL/blob/master/.github/CODE_OF_CONDUCT.md" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms. Thank you to all contributors!</p>
</div>
<div class="section level2">
<h2 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<p>Fei T, Funnell T, Waters NR, Raj SS, Baichoo M, Sadeghi K, Dai A, Miltiadous O, Shouval R, Lv M, Peled JU, Ponce DM, Perales MA, Gönen M, van den Brink MRM. Scalable log-ratio lasso regression for enhanced microbial feature selection with FLORAL, Cell Reports Methods (2024), 100899; doi: <a href="https://doi.org/10.1016/j.crmeth.2024.100899" class="external-link uri">https://doi.org/10.1016/j.crmeth.2024.100899</a>. Epub 2024 Nov 7. PMID: 39515336; PMCID: PMC11705925.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=FLORAL" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/vdblab/FLORAL/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/vdblab/FLORAL/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 3)</li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing FLORAL</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Teng Fei <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0001-7888-1715" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Tyler Funnell <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-1612-5644" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Nicholas Waters <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-9035-2143" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Sandeep Raj <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-4629-0528" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/vdblab/FLORAL/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/vdblab/FLORAL/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://cran.r-project.org/package=FLORAL" class="external-link"><img src="https://www.r-pkg.org/badges/version/FLORAL" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=FLORAL" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/FLORAL"></a></li>
<li><a href="https://cran.r-project.org/package=FLORAL" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/FLORAL"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Teng Fei, Tyler Funnell, Nicholas Waters, Sandeep Raj.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
